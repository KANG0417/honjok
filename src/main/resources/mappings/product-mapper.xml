<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProductMapper">
<!-- 상품 --> 
	<select id="productVO" parameterType="String" resultType="productVO">
		select * from product where p_num = #{pNum}
	</select>
	<!-- 상품 리뷰 --> 
	<select id="productReviewVO" parameterType="String" resultType="productReviewVO">
		select * from (select rownum num, n.* from (select * from product_review WHERE p_num = #{pNum} order by regdate desc) n
		)where num BETWEEN 1 and 5
	</select>
	
	<!-- 상품 등록  --> 
	<insert id="insertReview" parameterType="productReviewVO">
		insert into product_Review values(#{pNum},PRODUCT_REVIEW_SEQ.nextval,#{rating},#{pName,jdbcType=VARCHAR},#{id},sysdate,#{photoImage1,jdbcType=VARCHAR},#{title},#{content},#{photoImage2,jdbcType=VARCHAR})
	</insert>
	
	<!-- 리뷰 게시물 총 겟수 --> 
	<select id="getTotalCount" parameterType="String" resultType="Integer">
		select COUNT(*) from product_review WHERE p_num = #{pNum}
	</select>
	
	<select id="getreviewList" parameterType="Map" resultType="productReviewVO">
		select * from (select rownum num, n.* from (select * from product_review WHERE p_num = #{pNum} order by regdate desc) n
		)where num BETWEEN #{begin} and #{end}
	</select>

	<!-- qna 리뷰 글 등록 -->
	<select id="inserQnaReview" parameterType="productQnaVO">
		insert into product_qna (SEQ,
		COMMENT_PROC,
		IDX,
		TITLE,
		CONTENT,
		REGDATE,
		LEV,
		P_PROC,
		P_NAME,
		BUY_INFO,
		ID) values
		(#{seq},#{commentProc},PRODUCT_QNA_SEQ.nextval
		,#{title},#{content},sysdate,0,'처리중',#{pName}
		,'미구매',#{id})
	</select>

</mapper>