<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="honjokInfoMapper">



	<!-- 글등록 -->
	<insert id="insert" parameterType="CommInfoVO">
		{call
		declare
		begin
		INSERT INTO
		COMMUNITY(
		COM_SEQ,
		TITLE,
		ID,
		CONTENT,
		REGDATE,
		HIT,
		LIKES,
		TYPE,
		NICK_NAME
		)
		values((COMMMUNITY_SEQ.NEXTVAL) + 1,
		#{title}, #{id},
		#{content}, SYSDATE,
		'0', '0', '1', #{nick_name});
		INSERT INTO COMM_INFO
		VALUES((SELECT NVL(MAX(com_seq), 0) FROM COMMUNITY)
		,0,#{adr},#{menu},#{tel},#{place_name},#{category_name});
		END
		}
	</insert>
	
	<insert id="menuUplodat" parameterType="UploadVO">
			INSERT INTO UPLOAD(COM_SEQ,Up_img_name)
		VALUES((SELECT NVL(MAX(com_seq), 0) FROM COMMUNITY),#{up_img_name})
	</insert>


	<!-- insert end -->

	<!-- 커뮤니티 페이징 처리후 -->
	<select id="selectAll" resultType="CommunityVO"
		parameterType="Map">
		SELECT * FROM ( SELECT ROWNUM
		AS RECNUM,
		COM_SEQ,
		TITLE,
		ID,
		CONTENT,
		REGDATE,
		HIT,
		LIKES,
		TYPE FROM(SELECT COM_SEQ,
		TITLE,
		ID,
		CONTENT,
		REGDATE,
		HIT,
		NICK_NAME,
		LIKES,TYPE FROM COMMUNITY WHERE type =
		'1' order by com_seq DESC))
		where RECNUM BETWEEN (#{section}-1)* 90 +
		(#{pageNum}-1)* 9 + 1
		AND (#{section} - 1)*90 + #{pageNum}*9 order by
		com_seq DESC
	</select>

	<!-- 커뮤니티 인포 페이징 처리후 -->
	<select id="selectCommInfoVO" resultType="CommInfoVO"
		parameterType="Map">
		SELECT * FROM (SELECT ROWNUM
		AS RECNUM,
		COM_SEQ,
		SUM_STAR,
		ADR,
		MENU,
		tel,
		place_name,
		category_name
		FROM(SELECT * FROM COMM_INFO order by com_seq DESC))
		where RECNUM BETWEEN
		(#{section}-1)* 90 + (#{pageNum}-1)* 9 + 1
		AND (#{section} - 1)*90 +
		#{pageNum}*6 order by com_seq DESC
	</select>




	<select id="selectAllCount" resultType="Integer">
		select count(*)from
		community where type = '1'
	</select>





	<!-- 테이블 하나 가져오기 커퓨니티+info테이블 -->
	<select id="select" resultType="CommInfoVO"
		parameterType="String">
		select C.* ,I.* from COMMUNITY C, COMM_INFO I
		WHERE
		C.COM_SEQ = i.com_seq AND i.com_seq = #{com_seq}
	</select>
	
	<!-- 파일 이이미지 가져오기 -->
	
	<select id="getFileName" parameterType="String" resultType="UploadVO">
		 select * from upload where com_seq = #{com_seq}
	</select>






	<!-- select end -->


	<!-- 글삭제 -->
	<delete id="delete" parameterType="String">
		{call
		declare
		begin

		DELETE COMM_INFO WHERE COM_SEQ = #{com_seq};
		DELETE COMMUNITY WHERE COM_SEQ =
		#{com_seq};

		end
		}
	</delete>

	<update id="uptate" parameterType="CommInfoVO">
	{call
		declare
		begin
		UPDATE COMMUNITY
		SET
		TITLE = #{title},
		CONTENT = #{content},
		REGDATE = SYSDATE
		WHERE com_seq = #{com_seq};
		UPDATE COMM_INFO
		SET 
		ADR = #{adr},
		MENU = #{menu},
		TEL = #{tel},
		PLACE_NAME = #{place_name},
		CATEGORY_NAME = #{category_name}
		WHERE com_seq = #{com_seq};
		END
		}
	</update>


	<!-- <select id="getBoardList" parameterType="board" resultType="board"> 
		SELECT * FROM BOARD WHERE 1=1 <if test="searchCondition == 'TITLE' "> AND 
		TITLE LIKE '%'|| #{searchKeyword} ||'%' </if> <if test="searchCondition == 
		'CONTENT' "> AND CONTENT LIKE '%'|| #{searchKeyword} ||'%' </if> ORDER BY 
		SEQ DESC </select> <select id="getBoard" parameterType="board" resultType="board"> 
		SELECT * FROM BOARD WHERE SEQ = #{seq} </select> <update id="updateBoard" 
		parameterType="board"> UPDATE BOARD SET TITLE = #{title}, CONTENT = #{content} 
		WHERE SEQ = #{seq} </update> <delete id="deleteBoard" parameterType="board"> 
		DELETE FROM BOARD WHERE SEQ = #{seq} </delete> -->
</mapper>

